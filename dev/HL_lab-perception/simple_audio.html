<!DOCTYPE html>
<!--
Simple example of how to use the Web Audio API
loads sound file, plays it once any number of times, re-creating a source node each time
You need the audio file (C4-0.mp3) to be in the same directory, obviously
This only works on a server (not directly from a file) because of the XHR
-->
<html>
<head>
<script>

AUDIO_FILE = "C4-0.mp3";

// use XHR to load an audio track, and
// decodeAudioData to decode it and stick it in a buffer.
// Then we put the buffer into the source

function get_data()
{
	if(window.webkitAudioContext)
		audio_context = new window.webkitAudioContext();
	else
		audio_context = new window.AudioContext();

	request = new XMLHttpRequest();
	request.open("GET", AUDIO_FILE, true);
	request.responseType = "arraybuffer";
	request.onload = function() {
		let audio_data = request.response;		// audio_data is the raw date from the request
		audio_context.decodeAudioData(audio_data,
			function(buffer) {					// success callback; argument buffer is an AudioBuffer
				my_buffer = buffer;				// store buffer in global variable for future use
			},
			function(e) {						// error callback
				"Error with decoding audio data" + e.error
			}
		);
	};
	request.send();
}

window.onload = function()
{
	get_data();
	play_button = document.createElement("button");
	play_button.innerHTML = "Play";
	document.body.appendChild(play_button);
	play_button.onclick = function() {
		source_node = audio_context.createBufferSource();		// create single-use source node from audio buffer
		source_node.buffer = my_buffer;
		source_node.connect(audio_context.destination);
		source_node.loop = false;
		source_node.onended = function() { play_button.disabled = false; };
		source_node.start(0);
		play_button.disabled = true;
	};
};

</script>
</head>

<body>
</body>
  
</html>
